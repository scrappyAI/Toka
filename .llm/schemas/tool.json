{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/toka-ai/toka/.llm/schemas/tool.json",
  "title": "Tool Schema",
  "description": "General schema defining the structure any tool must follow",
  "version": "1.0.0",
  "type": "object",
  "required": ["metadata", "spec"],
  "properties": {
    "metadata": {
      "$ref": "#/definitions/metadata"
    },
    "spec": {
      "type": "object",
      "required": ["capabilities", "implementation", "interface"],
      "properties": {
        "capabilities": {
          "$ref": "#/definitions/capabilities"
        },
        "implementation": {
          "$ref": "#/definitions/implementation"
        },
        "interface": {
          "$ref": "#/definitions/interface"
        },
        "security": {
          "$ref": "#/definitions/security"
        },
        "performance": {
          "$ref": "#/definitions/performance"
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false,
  "definitions": {
    "metadata": {
      "type": "object",
      "required": ["name", "version", "description", "category"],
      "properties": {
        "name": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*[a-z0-9]$",
          "minLength": 3,
          "maxLength": 50,
          "description": "Tool name in kebab-case"
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Semantic version"
        },
        "description": {
          "type": "string",
          "minLength": 10,
          "maxLength": 500,
          "description": "Clear description of tool purpose"
        },
        "category": {
          "type": "string",
          "enum": [
            "file-operations",
            "data-processing", 
            "validation",
            "generation",
            "analysis",
            "system",
            "network",
            "database",
            "utility"
          ],
          "description": "Tool category"
        },
        "author": {
          "type": "string",
          "maxLength": 100,
          "description": "Tool author"
        },
        "created": {
          "type": "string",
          "format": "date-time",
          "description": "Creation timestamp in ISO 8601 format"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^[a-z][a-z0-9.-]*[a-z0-9]$"
          },
          "maxItems": 10,
          "description": "Tool tags for categorization"
        }
      },
      "additionalProperties": false
    },
    "capabilities": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": [
          "file-read",
          "file-write",
          "file-create",
          "file-delete",
          "command-execution",
          "http-requests",
          "text-processing",
          "json-processing",
          "yaml-processing",
          "markdown-processing",
          "schema-validation",
          "code-generation",
          "data-analysis",
          "system-monitoring",
          "database-read",
          "database-write",
          "network-access"
        ]
      },
      "minItems": 1,
      "maxItems": 10,
      "uniqueItems": true,
      "description": "Required capabilities for this tool"
    },
    "implementation": {
      "type": "object",
      "required": ["type", "entry_point"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["rust", "python", "javascript", "shell", "wasm"],
          "description": "Implementation type"
        },
        "entry_point": {
          "type": "string",
          "minLength": 1,
          "maxLength": 200,
          "description": "Entry point for tool execution"
        },
        "interpreter": {
          "type": "string",
          "maxLength": 50,
          "description": "Required interpreter (for scripted tools)"
        },
        "dependencies": {
          "type": "array",
          "items": {
            "type": "string",
            "maxLength": 100
          },
          "maxItems": 20,
          "description": "Required dependencies"
        },
        "working_directory": {
          "type": "string",
          "maxLength": 200,
          "description": "Working directory for execution"
        }
      },
      "additionalProperties": false
    },
    "interface": {
      "type": "object",
      "required": ["inputs", "outputs"],
      "properties": {
        "inputs": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/parameter"
          },
          "maxItems": 20,
          "description": "Tool input parameters"
        },
        "outputs": {
          "type": "object",
          "required": ["format"],
          "properties": {
            "format": {
              "type": "string",
              "enum": ["json", "text", "binary", "stream"],
              "description": "Output format"
            },
            "schema": {
              "type": "object",
              "description": "Output schema (for structured formats)"
            },
            "encoding": {
              "type": "string",
              "enum": ["utf-8", "ascii", "binary"],
              "default": "utf-8",
              "description": "Output encoding"
            }
          },
          "additionalProperties": false
        },
        "error_handling": {
          "type": "object",
          "properties": {
            "strategy": {
              "type": "string",
              "enum": ["fail-fast", "graceful", "retry"],
              "default": "graceful",
              "description": "Error handling strategy"
            },
            "max_retries": {
              "type": "integer",
              "minimum": 0,
              "maximum": 5,
              "default": 0,
              "description": "Maximum retry attempts"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "parameter": {
      "type": "object",
      "required": ["name", "type", "required"],
      "properties": {
        "name": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9_]*$",
          "minLength": 1,
          "maxLength": 50,
          "description": "Parameter name in snake_case"
        },
        "type": {
          "type": "string",
          "enum": ["string", "integer", "number", "boolean", "array", "object"],
          "description": "Parameter type"
        },
        "required": {
          "type": "boolean",
          "description": "Whether parameter is required"
        },
        "description": {
          "type": "string",
          "minLength": 5,
          "maxLength": 200,
          "description": "Parameter description"
        },
        "default": {
          "description": "Default value for optional parameters"
        },
        "validation": {
          "type": "object",
          "properties": {
            "pattern": {
              "type": "string",
              "description": "Regex pattern for string validation"
            },
            "min": {
              "type": "number",
              "description": "Minimum value"
            },
            "max": {
              "type": "number", 
              "description": "Maximum value"
            },
            "enum": {
              "type": "array",
              "description": "Allowed values"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "security": {
      "type": "object",
      "required": ["level"],
      "properties": {
        "level": {
          "type": "string",
          "enum": ["sandbox", "restricted", "elevated"],
          "description": "Security level for tool execution"
        },
        "sandbox": {
          "type": "object",
          "properties": {
            "network_access": {
              "type": "boolean",
              "default": false,
              "description": "Allow network access"
            },
            "file_system_access": {
              "type": "string",
              "enum": ["none", "read-only", "restricted", "full"],
              "default": "restricted",
              "description": "File system access level"
            },
            "allowed_paths": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "maxItems": 10,
              "description": "Allowed file system paths"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "performance": {
      "type": "object",
      "properties": {
        "timeout": {
          "type": "string",
          "pattern": "^\\d+[smh]$",
          "default": "30s",
          "description": "Maximum execution time"
        },
        "memory_limit": {
          "type": "string",
          "pattern": "^\\d+[KMGT]?B$",
          "default": "256MB",
          "description": "Maximum memory usage"
        },
        "cpu_limit": {
          "type": "string",
          "pattern": "^\\d+%$",
          "default": "50%",
          "description": "Maximum CPU usage"
        }
      },
      "additionalProperties": false
    }
  }
} 